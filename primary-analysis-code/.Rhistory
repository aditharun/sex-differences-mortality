agevector <- agevector %>% mutate(r = rank(age))
agevector
ypll_age %>% pivot_longer(-c(age_cat, age, icdcode), names_to="Gender") %>% left_join(icdmap, by=c("icdcode"="code")) %>% mutate(name = str_wrap(name, width = 25)) %>% mutate(age_cat = gsub(" years", "", age_cat)) %>% mutate(age = ifelse(is.na(age), 0, age)) %>% left_join(agevector %>% select(r, age), by=c("age"="age")) %>% select(-age)
ypll_age %>% pivot_longer(-c(age_cat, age, icdcode), names_to="Gender") %>% left_join(icdmap, by=c("icdcode"="code")) %>% mutate(name = str_wrap(name, width = 25)) %>% mutate(age_cat = gsub(" years", "", age_cat)) %>% mutate(age = ifelse(is.na(age), 0, age)) %>% left_join(agevector %>% select(r, age), by=c("age"="age")) %>% select(-age)  %>% arrange(r)
ypll_age <- lapply(file.path(tabledir, "ypll_age.csv"), function(x) x %>% extract_information(.)) %>% do.call(rbind, .) %>% mutate(age = sub("-(.*)", "", age_cat) %>% as.numeric())
agevector <- ypll_age %>% select(age_cat, age) %>% distinct() %>% arrange(age) %>% mutate(age_cat = gsub(" years", "", age_cat))
agevector <- agevector %>% mutate(age = ifelse(age_cat== "< 1 year", 0, age))  %>% mutate( age_cat = gsub(" years*", "", age_cat)) %>% arrange(age)
agevector <- agevector %>% mutate(r = rank(age))
ypll_age <- ypll_age %>% pivot_longer(-c(age_cat, age, icdcode), names_to="Gender") %>% left_join(icdmap, by=c("icdcode"="code")) %>% mutate(name = str_wrap(name, width = 25)) %>% mutate(age_cat = gsub(" years", "", age_cat)) %>% mutate(age = ifelse(is.na(age), 0, age)) %>% left_join(agevector %>% select(r, age), by=c("age"="age")) %>% select(-age)
colnames(ypll_age)[colnames(ypll_age)=="r"] <- "age"
ypll_age_fig <- ypll_age  %>% ggplot(aes(x=age, y=value, color=Gender)) + geom_point(size = 2, alpha = 0.75) + geom_line(size = 0.85) + theme_minimal() + theme(legend.position = "right")  + theme(axis.line.x = element_line(color = "black"), axis.line.y = element_line(color = "black")) + theme(axis.ticks = element_line(color = "black")) + ylab("AAMR per 100,000") + theme(panel.grid = element_blank()) + xlab("Age Group") + theme(axis.text.y = element_text(size = 10), axis.title = element_text(size = 10)) + theme(strip.text = element_text(hjust = 0.5, size = 9)) + scale_y_continuous(breaks = scales::pretty_breaks(n = 4)) + scale_x_continuous(limits=c(min(agevector$age),max(agevector$age)), breaks=agevector$age, labels=agevector$age_cat) + scale_color_manual(values = c("male_years_lost"=colorpal[1], "female_years_lost"=colorpal[2]), labels = c("male_years_lost" = "Male", "female_years_lost" = "Female")) + facet_wrap(~name, scales="free", nrow = 4) + theme(axis.text.x = element_text(size = 8, angle = 45, hjust = 1))
ypll_age_fig
ypll_age_fig <- ypll_age  %>% ggplot(aes(x=age, y=value, color=Gender)) + geom_point(size = 2, alpha = 0.75) + geom_line(size = 0.85) + theme_minimal() + theme(legend.position = "right")  + theme(axis.line.x = element_line(color = "black"), axis.line.y = element_line(color = "black")) + theme(axis.ticks = element_line(color = "black")) + ylab("AAMR per 100,000") + theme(panel.grid = element_blank()) + xlab("Age Group") + theme(axis.text.y = element_text(size = 10), axis.title = element_text(size = 10)) + theme(strip.text = element_text(hjust = 0.5, size = 9)) + scale_y_continuous(breaks = scales::pretty_breaks(n = 4)) + scale_x_continuous(limits=c(min(agevector$r),max(agevector$r)), breaks=agevector$r, labels=agevector$age_cat) + scale_color_manual(values = c("male_years_lost"=colorpal[1], "female_years_lost"=colorpal[2]), labels = c("male_years_lost" = "Male", "female_years_lost" = "Female")) + facet_wrap(~name, scales="free", nrow = 4) + theme(axis.text.x = element_text(size = 8, angle = 45, hjust = 1))
ypll_age_fig
ypll_age_year <- lapply(file.path(tabledir, "ypll_sex_age_year.csv"), function(x) x %>% extract_information(.)) %>% do.call(rbind, .)
ypll_age_year
ypll_age_year %>% filter(is.na(age))
ypll_age_year %>% filter(age == 0)
ypll_age_year %>% arrange(age)
ypll_age_year %>% arrange(age) %>% relocate(age)
ypll_age_year %>% left_join(icdmap, by=c("icdcode"="code")) %>% mutate(name = str_wrap(name, width = 25))  %>% ggplot(aes(x=age, y=excess_yrs_lost, group=Year)) + geom_line(aes(color=Year), size=0.5) + ylab("Excess YPLL per 100K individuals") + scale_y_continuous(breaks=scales::pretty_breaks(n = 4)) + geom_hline(yintercept=0, linetype="dashed") + sizing_theme + scale_color_manual(name="Year Range", values=colorpal[1:4]) + panel_theme + scale_x_continuous(limits=c(min(agevector$r),max(agevector$r)), breaks=agevector$r, labels=agevector$age_cat) + theme(axis.text.x = element_text(angle=45, hjust=1)) + xlab("Age group (years)") + geom_point(aes(color=Year), size=2.5) + theme(strip.text = element_text(size=11), strip.background=element_rect(fill="transparent", color="transparent")) + facet_wrap(~name, scales="free", nrow = 6) + theme(axis.text.x = element_text(size = 8, angle = 45, hjust = 1))
aadr_age_year <- lapply(file.path(tabledir, "aadr_sex_age_year.csv"), function(x) x %>% extract_information(.)) %>% do.call(rbind, .)
aadr_age_year
aadr_age_year %>% filter(is.na(age))
aadr_age_year %>% arrange(age)
aadr_age_year %>% arrange(age) %>% relocate(age)
aadr_age_year %>% left_join(icdmap, by=c("icdcode"="code")) %>% mutate(name = str_wrap(name, width = 25))  %>% ggplot(aes(x=age, y=unadj_excess_deaths_rate, group=Year)) + geom_line(aes(color=Year), size=0.5) + ylab("Excess AAMR per 100K individuals") + scale_y_continuous(breaks=scales::pretty_breaks(n = 4)) + geom_hline(yintercept=0, linetype="dashed") + sizing_theme + scale_color_manual(name="Year Range", values=colorpal[1:4]) + panel_theme + scale_x_continuous(limits=c(min(agevector$age),max(agevector$age)), breaks=agevector$age, labels=agevector$age_cat) + theme(axis.text.x = element_text(angle=45, hjust=1)) + xlab("Age group (years)") + geom_point(aes(color=Year), size=2.5) + theme(strip.text = element_text(size=11), strip.background=element_rect(fill="transparent", color="transparent")) + facet_wrap(~name, scales="free", nrow = 6) + theme(axis.text.x = element_text(size = 8, angle = 45, hjust = 1))
aadr_age_year %>% left_join(icdmap, by=c("icdcode"="code")) %>% mutate(name = str_wrap(name, width = 25))  %>% ggplot(aes(x=age, y=unadj_excess_deaths_rate, group=Year)) + geom_line(aes(color=Year), size=0.5) + ylab("Excess AAMR per 100K individuals") + scale_y_continuous(breaks=scales::pretty_breaks(n = 4)) + geom_hline(yintercept=0, linetype="dashed") + sizing_theme + scale_color_manual(name="Year Range", values=colorpal[1:4]) + panel_theme + scale_x_continuous(limits=c(min(agevector$r),max(agevector$r)), breaks=agevector$r, labels=agevector$age_cat) + theme(axis.text.x = element_text(angle=45, hjust=1)) + xlab("Age group (years)") + geom_point(aes(color=Year), size=2.5) + theme(strip.text = element_text(size=11), strip.background=element_rect(fill="transparent", color="transparent")) + facet_wrap(~name, scales="free", nrow = 6) + theme(axis.text.x = element_text(size = 8, angle = 45, hjust = 1))
resultsdir %>% file.path("all-deaths", "excess-mortality-by-age", "excess_death_rate_age_fig.rds") %>% readRDS() + theme(panel.grid = element_blank()) + ylab("Excess Deaths per 100,000") + theme(axis.title = element_text(size = 14), axis.text = element_text(size = 10)) + xlab("Age Group") + geom_point(size = 3, color = "grey70") + geom_line(color = "grey70") + theme(plot.title = element_blank())
resultsdir %>% file.path("all-deaths", "excess-mortality-by-age", "excess_death_rate_age_fig.rds") %>% readRDS()
resultsdir
resultsdir <- "../results"
resultsdir %>% file.path("all-deaths", "excess-mortality-by-age", "excess_death_rate_age_fig.rds") %>% readRDS()
resultsdir %>% file.path("all-deaths", "excess-mortality-by-age", "excess_death_rate_age_fig.rds") %>% readRDS() + theme(panel.grid = element_blank()) + ylab("Excess Deaths per 100,000") + theme(axis.title = element_text(size = 14), axis.text = element_text(size = 10)) + xlab("Age Group") + geom_point(size = 3, color = "grey70") + geom_line(color = "grey70") + theme(plot.title = element_blank())
resultsdir %>% file.path("all-deaths", "excess-mortality-by-age", "excess_death_rate_age_year_fig.rds") %>% readRDS()  + theme(panel.grid = element_blank()) + ylab("Excess Deaths per 100,000") + theme(axis.title = element_text(size = 14), axis.text = element_text(size = 10)) + xlab("Age Group")  + theme(plot.title = element_blank())
resultsdir %>% file.path("all-deaths", "life-years-lost-by-age", "excess_pll_fig.rds") %>% readRDS() + theme(panel.grid = element_blank()) + ylab("Excess Deaths per 100,000") + theme(axis.title = element_text(size = 14), axis.text = element_text(size = 10)) + xlab("Age Group") + geom_point(size = 3, color = "grey70") + geom_line(color = "grey70") + theme(plot.title = element_blank())
resultsdir %>% file.path("all-deaths", "life-years-lost-by-age", "excess_pll_fig.rds") %>% readRDS()
resultsdir %>% file.path("all-deaths", "life-years-lost-by-age", "excess_pll_fig.rds") %>% readRDS() + theme(panel.grid = element_blank()) + ylab("Excess YPLL per 100,000") + theme(axis.title = element_text(size = 14), axis.text = element_text(size = 10)) + xlab("Age Group") + geom_point(size = 3, color = "grey70") + geom_line(color = "grey70") + theme(plot.title = element_blank())
resultsdir %>% file.path("all-deaths", "life-years-lost-by-age", "excess_pll_year_fig.rds") %>% readRDS() + theme(panel.grid = element_blank()) + ylab("Excess YPLL per 100,000") + theme(axis.title = element_text(size = 14), axis.text = element_text(size = 10)) + xlab("Age Group")  + theme(plot.title = element_blank())
cowplot::plot_grid(resultsdir %>% file.path("all-deaths", "excess-mortality-by-age", "excess_death_rate_age_fig.rds") %>% readRDS() + theme(panel.grid = element_blank()) + ylab("Excess Deaths per 100,000") + theme(axis.title = element_text(size = 14), axis.text = element_text(size = 10)) + xlab("Age Group") + geom_point(size = 3, color = "grey70") + geom_line(color = "grey70") + theme(plot.title = element_blank()),
resultsdir %>% file.path("all-deaths", "excess-mortality-by-age", "excess_death_rate_age_year_fig.rds") %>% readRDS()  + theme(panel.grid = element_blank()) + ylab("Excess Deaths per 100,000") + theme(axis.title = element_text(size = 14), axis.text = element_text(size = 10)) + xlab("Age Group")  + theme(plot.title = element_blank()),
resultsdir %>% file.path("all-deaths", "life-years-lost-by-age", "excess_pll_fig.rds") %>% readRDS() + theme(panel.grid = element_blank()) + ylab("Excess YPLL per 100,000") + theme(axis.title = element_text(size = 14), axis.text = element_text(size = 10)) + xlab("Age Group") + geom_point(size = 3, color = "grey70") + geom_line(color = "grey70") + theme(plot.title = element_blank()),
resultsdir %>% file.path("all-deaths", "life-years-lost-by-age", "excess_pll_year_fig.rds") %>% readRDS() + theme(panel.grid = element_blank()) + ylab("Excess YPLL per 100,000") + theme(axis.title = element_text(size = 14), axis.text = element_text(size = 10)) + xlab("Age Group")  + theme(plot.title = element_blank()), nrow = 2, ncol = 2, rel_widths = c(1, 1.25), labels = c("A", "B", "C", "D"), label_size = 16)
ggsave(plot = fig4, filename = file.path(msdir, "male-female-fig4.pdf"), width = 12, height = 12, units = "in", device = cairo_pdf)
fig4 <- cowplot::plot_grid(resultsdir %>% file.path("all-deaths", "excess-mortality-by-age", "excess_death_rate_age_fig.rds") %>% readRDS() + theme(panel.grid = element_blank()) + ylab("Excess Deaths per 100,000") + theme(axis.title = element_text(size = 14), axis.text = element_text(size = 10)) + xlab("Age Group") + geom_point(size = 3, color = "grey70") + geom_line(color = "grey70") + theme(plot.title = element_blank()),
resultsdir %>% file.path("all-deaths", "excess-mortality-by-age", "excess_death_rate_age_year_fig.rds") %>% readRDS()  + theme(panel.grid = element_blank()) + ylab("Excess Deaths per 100,000") + theme(axis.title = element_text(size = 14), axis.text = element_text(size = 10)) + xlab("Age Group")  + theme(plot.title = element_blank()),
resultsdir %>% file.path("all-deaths", "life-years-lost-by-age", "excess_pll_fig.rds") %>% readRDS() + theme(panel.grid = element_blank()) + ylab("Excess YPLL per 100,000") + theme(axis.title = element_text(size = 14), axis.text = element_text(size = 10)) + xlab("Age Group") + geom_point(size = 3, color = "grey70") + geom_line(color = "grey70") + theme(plot.title = element_blank()),
resultsdir %>% file.path("all-deaths", "life-years-lost-by-age", "excess_pll_year_fig.rds") %>% readRDS() + theme(panel.grid = element_blank()) + ylab("Excess YPLL per 100,000") + theme(axis.title = element_text(size = 14), axis.text = element_text(size = 10)) + xlab("Age Group")  + theme(plot.title = element_blank()), nrow = 2, ncol = 2, rel_widths = c(1, 1.25), labels = c("A", "B", "C", "D"), label_size = 16)
ggsave(plot = fig4, filename = file.path(msdir, "male-female-fig4.pdf"), width = 12, height = 12, units = "in", device = cairo_pdf)
ggsave(plot = fig4, filename = file.path(msdir, "male-female-fig4.pdf"), width = 13, height = 9, units = "in", device = cairo_pdf)
resultsdir %>% file.path(., "icd", "aamr_age_fig.rds") %>% readRDS()
resultsdir %>% file.path(., "icd", "aamr_age_fig.rds") %>% readRDS() + theme(panel.grid = element_blank()) + ylab("AAMR per 100,000") + theme(axis.title = element_text(size = 14), axis.text = element_text(size = 10))
sfig3 <- resultsdir %>% file.path(., "icd", "aamr_age_fig.rds") %>% readRDS() + theme(panel.grid = element_blank()) + ylab("AAMR per 100,000") + theme(axis.title = element_text(size = 14), axis.text = element_text(size = 10))
sfig3
resultsdir %>% file.path(., "icd", "ypll_fig.rds")
resultsdir %>% file.path(., "icd", "ypll_fig.rds")
%>% readRDS()
resultsdir %>% file.path(., "icd", "ypll_fig.rds") %>% readRDS()
resultsdir %>% file.path(., "icd", "ypll_age_fig.rds") %>% readRDS()
file.path(tabledir, "aadr_sex_age.csv")[1]
tabledir[1] %>% list.files()
eaamr_age <- lapply(file.path(tabledir, "excess_aadr_year.csv"), function(x) x %>% extract_information(.)) %>% do.call(rbind, .) %>% mutate(age = sub("-(.*)", "", `Age Group`) %>% as.numeric())
eaamr_age
eaamr_age <- lapply(file.path(tabledir, "excess_aadr_year.csv"), function(x) x %>% extract_information(.)) %>% do.call(rbind, .)
eaamr_age
tabledir[1] %>% list.files()
eaamr_age <- lapply(file.path(tabledir, "excess_aadr_age.csv"), function(x) x %>% extract_information(.)) %>% do.call(rbind, .)
eaamr_age
eaamr_age <- lapply(file.path(tabledir, "excess_aadr_age.csv"), function(x) x %>% extract_information(.)) %>% do.call(rbind, .) %>% mutate(age = sub("-(.*)", "", `Age Group`) %>% as.numeric())
eaamr_age
eaamr_age <- lapply(file.path(tabledir, "excess_aadr_age.csv"), function(x) x %>% extract_information(.)) %>% do.call(rbind, .) %>% mutate(age = sub("-(.*)", "", `Age Group`) %>% as.numeric()) %>% magrittr:set_colnames(c("Age Group", "edn", "edr", "icdcode", "age"))
eaamr_age %>% pivot_longer(-c(`Age Group`, age, icdcode), names_to="name")
eaamr_age <- lapply(file.path(tabledir, "excess_aadr_age.csv"), function(x) x %>% extract_information(.)) %>% do.call(rbind, .) %>% mutate(age = sub("-(.*)", "", `Age Group`) %>% as.numeric()) %>% magrittr::set_colnames(c("Age Group", "edn", "edr", "icdcode", "age"))
eaamr_age <- eaamr_age %>% pivot_longer(-c(`Age Group`, age, icdcode), names_to="name") %>% left_join(icdmap, by=c("icdcode"="code")) %>% mutate(name = str_wrap(name, width = 25)) %>% mutate(`Age Group` = gsub(" years", "", `Age Group`)) %>% mutate(age = ifelse(is.na(age), 0, age)) %>% left_join(agevector %>% select(r, age), by=c("age"="age")) %>% select(-age)
eaamr_age <- eaamr_age %>% pivot_longer(-c(`Age Group`, age, icdcode), names_to="metric") %>% left_join(icdmap, by=c("icdcode"="code")) %>% mutate(name = str_wrap(name, width = 25)) %>% mutate(`Age Group` = gsub(" years", "", `Age Group`)) %>% mutate(age = ifelse(is.na(age), 0, age)) %>% left_join(agevector %>% select(r, age), by=c("age"="age")) %>% select(-age)
eaamr_age
colnames(eaamr_age)[colnames(eaamr_age)=="r"] <- "age"
eaamr_age
eaamr_age  %>% filter(metric == "edr") >%% ggplot(aes(x=age, y=value), color = "grey70") + geom_point(size = 2, alpha = 0.75) + geom_line(size = 0.85) + theme_minimal() + theme(legend.position = "right")  + theme(axis.line.x = element_line(color = "black"), axis.line.y = element_line(color = "black")) + theme(axis.ticks = element_line(color = "black")) + ylab("Excess AAMR per 100,000") + theme(panel.grid = element_blank()) + xlab("Age Group") + theme(axis.text.y = element_text(size = 10), axis.title = element_text(size = 10)) + theme(strip.text = element_text(hjust = 0.5, size = 9)) + scale_y_continuous(breaks = scales::pretty_breaks(n = 4)) + scale_x_continuous(limits=c(min(agevector$r),max(agevector$r)), breaks=agevector$r, labels=agevector$`Age Group`) + facet_wrap(~name, scales="free", nrow = 4) + theme(axis.text.x = element_text(size = 8, angle = 45, hjust = 1))
eaamr_age  %>% filter(metric == "edr") %>% ggplot(aes(x=age, y=value), color = "grey70") + geom_point(size = 2, alpha = 0.75) + geom_line(size = 0.85) + theme_minimal() + theme(legend.position = "right")  + theme(axis.line.x = element_line(color = "black"), axis.line.y = element_line(color = "black")) + theme(axis.ticks = element_line(color = "black")) + ylab("Excess AAMR per 100,000") + theme(panel.grid = element_blank()) + xlab("Age Group") + theme(axis.text.y = element_text(size = 10), axis.title = element_text(size = 10)) + theme(strip.text = element_text(hjust = 0.5, size = 9)) + scale_y_continuous(breaks = scales::pretty_breaks(n = 4)) + scale_x_continuous(limits=c(min(agevector$r),max(agevector$r)), breaks=agevector$r, labels=agevector$`Age Group`) + facet_wrap(~name, scales="free", nrow = 4) + theme(axis.text.x = element_text(size = 8, angle = 45, hjust = 1))
agevector
aamr_age <- lapply(file.path(tabledir, "aadr_sex_age.csv"), function(x) x %>% extract_information(.)) %>% do.call(rbind, .) %>% mutate(age = sub("-(.*)", "", `Age Group`) %>% as.numeric())
agevector <- aamr_age %>% select(`Age Group`, age) %>% distinct() %>% arrange(age) %>% mutate(`Age Group` = gsub(" years", "", `Age Group`))
agevector <- agevector %>% mutate(age = ifelse(`Age Group`== "< 1 year", 0, age))  %>% mutate(`Age Group` = gsub(" years*", "", `Age Group`)) %>% arrange(age)
agevector <- agevector %>% mutate(r = rank(age))
aamr_age <- aamr_age %>% pivot_longer(-c(`Age Group`, age, icdcode), names_to="Gender") %>% left_join(icdmap, by=c("icdcode"="code")) %>% mutate(name = str_wrap(name, width = 25)) %>% mutate(`Age Group` = gsub(" years", "", `Age Group`)) %>% mutate(age = ifelse(is.na(age), 0, age)) %>% left_join(agevector %>% select(r, age), by=c("age"="age")) %>% select(-age)
colnames(aamr_age)[colnames(aamr_age)=="r"] <- "age"
aamr_age_fig <- aamr_age  %>% ggplot(aes(x=age, y=value, color=Gender)) + geom_point(size = 2, alpha = 0.75) + geom_line(size = 0.85) + theme_minimal() + theme(legend.position = "right")  + theme(axis.line.x = element_line(color = "black"), axis.line.y = element_line(color = "black")) + theme(axis.ticks = element_line(color = "black")) + ylab("AAMR per 100,000") + theme(panel.grid = element_blank()) + xlab("Age Group") + theme(axis.text.y = element_text(size = 10), axis.title = element_text(size = 10)) + theme(strip.text = element_text(hjust = 0.5, size = 9)) + scale_y_continuous(breaks = scales::pretty_breaks(n = 4)) + scale_x_continuous(limits=c(min(agevector$r),max(agevector$r)), breaks=agevector$r, labels=agevector$`Age Group`) + scale_color_manual(values = c("Male Death Rate"=colorpal[1], "Female Death Rate"=colorpal[2]), labels = c("Male Death Rate" = "Male", "Female Death Rate" = "Female")) + facet_wrap(~name, scales="free", nrow = 4) + theme(axis.text.x = element_text(size = 8, angle = 45, hjust = 1))
eaamr_age <- lapply(file.path(tabledir, "excess_aadr_age.csv"), function(x) x %>% extract_information(.)) %>% do.call(rbind, .) %>% mutate(age = sub("-(.*)", "", `Age Group`) %>% as.numeric()) %>% magrittr::set_colnames(c("Age Group", "edn", "edr", "icdcode", "age"))
eaamr_age <- eaamr_age %>% pivot_longer(-c(`Age Group`, age, icdcode), names_to="metric") %>% left_join(icdmap, by=c("icdcode"="code")) %>% mutate(name = str_wrap(name, width = 25)) %>% mutate(`Age Group` = gsub(" years", "", `Age Group`)) %>% mutate(age = ifelse(is.na(age), 0, age)) %>% left_join(agevector %>% select(r, age), by=c("age"="age")) %>% select(-age)
colnames(eaamr_age)[colnames(eaamr_age)=="r"] <- "age"
eaamr_age_fig <- eaamr_age  %>% filter(metric == "edr") %>% ggplot(aes(x=age, y=value), color = "grey70") + geom_point(size = 2, alpha = 0.75) + geom_line(size = 0.85) + theme_minimal() + theme(legend.position = "right")  + theme(axis.line.x = element_line(color = "black"), axis.line.y = element_line(color = "black")) + theme(axis.ticks = element_line(color = "black")) + ylab("Excess AAMR per 100,000") + theme(panel.grid = element_blank()) + xlab("Age Group") + theme(axis.text.y = element_text(size = 10), axis.title = element_text(size = 10)) + theme(strip.text = element_text(hjust = 0.5, size = 9)) + scale_y_continuous(breaks = scales::pretty_breaks(n = 4)) + scale_x_continuous(limits=c(min(agevector$r),max(agevector$r)), breaks=agevector$r, labels=agevector$`Age Group`) + facet_wrap(~name, scales="free", nrow = 4) + theme(axis.text.x = element_text(size = 8, angle = 45, hjust = 1))
eaamr_age_fig
eaamr_age  %>% filter(metric == "edr") %>% ggplot(aes(x=age, y=value)) + heme_minimal() + geom_point(size = 2, alpha = 0.75, color = "grey70") + geom_line(size = 0.85, color = "grey70")  + theme(legend.position = "right")  + theme(axis.line.x = element_line(color = "black"), axis.line.y = element_line(color = "black")) + theme(axis.ticks = element_line(color = "black")) + ylab("Excess AAMR per 100,000") + theme(panel.grid = element_blank()) + xlab("Age Group") + theme(axis.text.y = element_text(size = 10), axis.title = element_text(size = 10)) + theme(strip.text = element_text(hjust = 0.5, size = 9)) + scale_y_continuous(breaks = scales::pretty_breaks(n = 4)) + scale_x_continuous(limits=c(min(agevector$r),max(agevector$r)), breaks=agevector$r, labels=agevector$`Age Group`) + facet_wrap(~name, scales="free", nrow = 4) + theme(axis.text.x = element_text(size = 8, angle = 45, hjust = 1))
eaamr_age  %>% filter(metric == "edr") %>% ggplot(aes(x=age, y=value)) + theme_minimal() + geom_point(size = 2, alpha = 0.75, color = "grey70") + geom_line(size = 0.85, color = "grey70")  + theme(legend.position = "right")  + theme(axis.line.x = element_line(color = "black"), axis.line.y = element_line(color = "black")) + theme(axis.ticks = element_line(color = "black")) + ylab("Excess AAMR per 100,000") + theme(panel.grid = element_blank()) + xlab("Age Group") + theme(axis.text.y = element_text(size = 10), axis.title = element_text(size = 10)) + theme(strip.text = element_text(hjust = 0.5, size = 9)) + scale_y_continuous(breaks = scales::pretty_breaks(n = 4)) + scale_x_continuous(limits=c(min(agevector$r),max(agevector$r)), breaks=agevector$r, labels=agevector$`Age Group`) + facet_wrap(~name, scales="free", nrow = 4) + theme(axis.text.x = element_text(size = 8, angle = 45, hjust = 1))
ypll_age <- lapply(file.path(tabledir, "ypll_age.csv"), function(x) x %>% extract_information(.)) %>% do.call(rbind, .) %>% mutate(age = sub("-(.*)", "", age_cat) %>% as.numeric())
agevector <- ypll_age %>% select(age_cat, age) %>% distinct() %>% arrange(age) %>% mutate(age_cat = gsub(" years", "", age_cat))
agevector <- agevector %>% mutate(age = ifelse(age_cat== "< 1 year", 0, age))  %>% mutate( age_cat = gsub(" years*", "", age_cat)) %>% arrange(age)
agevector <- agevector %>% mutate(r = rank(age))
ypll_age <- ypll_age %>% pivot_longer(-c(age_cat, age, icdcode), names_to="Gender") %>% left_join(icdmap, by=c("icdcode"="code")) %>% mutate(name = str_wrap(name, width = 25)) %>% mutate(age_cat = gsub(" years", "", age_cat)) %>% mutate(age = ifelse(is.na(age), 0, age)) %>% left_join(agevector %>% select(r, age), by=c("age"="age")) %>% select(-age)
colnames(ypll_age)[colnames(ypll_age)=="r"] <- "age"
ypll_age_fig <- ypll_age  %>% ggplot(aes(x=age, y=value, color=Gender)) + geom_point(size = 2, alpha = 0.75) + geom_line(size = 0.85) + theme_minimal() + theme(legend.position = "right")  + theme(axis.line.x = element_line(color = "black"), axis.line.y = element_line(color = "black")) + theme(axis.ticks = element_line(color = "black")) + ylab("YPLL per 100,000") + theme(panel.grid = element_blank()) + xlab("Age Group") + theme(axis.text.y = element_text(size = 10), axis.title = element_text(size = 10)) + theme(strip.text = element_text(hjust = 0.5, size = 9)) + scale_y_continuous(breaks = scales::pretty_breaks(n = 4)) + scale_x_continuous(limits=c(min(agevector$r),max(agevector$r)), breaks=agevector$r, labels=agevector$age_cat) + scale_color_manual(values = c("male_years_lost"=colorpal[1], "female_years_lost"=colorpal[2]), labels = c("male_years_lost" = "Male", "female_years_lost" = "Female")) + facet_wrap(~name, scales="free", nrow = 4) + theme(axis.text.x = element_text(size = 8, angle = 45, hjust = 1))
tabledir[1] %>% list.files()
tabledir[1] %>% file.path(., "ypll_sex_year.csv") %>% read_csv()
eypll_age <- lapply(file.path(tabledir, "ypll_sex_age.csv"), function(x) x %>% extract_information(.)) %>% do.call(rbind, .) %>% mutate(age = sub("-(.*)", "", age_cat) %>% as.numeric())
file.path(tabledir, "ypll_sex_age.csv")[1] %>% read_csv()
eypll_age <- lapply(file.path(tabledir, "ypll_sex_age.csv"), function(x) x %>% extract_information(.)) %>% do.call(rbind, .) %>% magrittr::set_colnames(c("age_cat", "excess_rate", "excess_ypll_number")) %>% mutate(age = sub("-(.*)", "", age_cat) %>% as.numeric())
eypll_age
file.path(tabledir, "ypll_sex_age.csv")[1] %>% read_csv()
lapply(file.path(tabledir, "ypll_sex_age.csv"), function(x) x %>% extract_information(.)) %>% do.call(rbind, .) %>% magrittr::set_colnames(c("age_cat", "excess_rate", "excess_ypll_number"))
eypll_age <- lapply(file.path(tabledir, "ypll_sex_age.csv"), function(x) x %>% extract_information(.)) %>% do.call(rbind, .) %>% magrittr::set_colnames(c("age_cat", "excess_rate", "excess_ypll_number", "icdcode")) %>% mutate(age = sub("-(.*)", "", age_cat) %>% as.numeric())
eypll_age <- eypll_age %>% pivot_longer(-c(age_cat, age, icdcode), names_to="metric") %>% left_join(icdmap, by=c("icdcode"="code")) %>% mutate(name = str_wrap(name, width = 25)) %>% mutate(age_cat = gsub(" years", "", age_cat)) %>% mutate(age = ifelse(is.na(age), 0, age)) %>% left_join(agevector %>% select(r, age), by=c("age"="age")) %>% select(-age)
eypll_age
colnames(eypll_age)[colnames(eypll_age)=="r"] <- "age"
eypll_age_fig <- eypll_age  %>% ggplot(aes(x=age, y=value)) + theme_minimal() + geom_point(size = 2, alpha = 0.75, color = "grey70") + geom_line(size = 0.85, color = "grey70")  + theme(legend.position = "right")  + theme(axis.line.x = element_line(color = "black"), axis.line.y = element_line(color = "black")) + theme(axis.ticks = element_line(color = "black")) + ylab("YPLL per 100,000") + theme(panel.grid = element_blank()) + xlab("Age Group") + theme(axis.text.y = element_text(size = 10), axis.title = element_text(size = 10)) + theme(strip.text = element_text(hjust = 0.5, size = 9)) + scale_y_continuous(breaks = scales::pretty_breaks(n = 4)) + scale_x_continuous(limits=c(min(agevector$r),max(agevector$r)), breaks=agevector$r, labels=agevector$age_cat) + facet_wrap(~name, scales="free", nrow = 4) + theme(axis.text.x = element_text(size = 8, angle = 45, hjust = 1))
eypll_age_fig
eypll_age_fig <- eypll_age %>% filter(metric == "excess_ypll_number") %>% ggplot(aes(x=age, y=value)) + theme_minimal() + geom_point(size = 2, alpha = 0.75, color = "grey70") + geom_line(size = 0.85, color = "grey70")  + theme(legend.position = "right")  + theme(axis.line.x = element_line(color = "black"), axis.line.y = element_line(color = "black")) + theme(axis.ticks = element_line(color = "black")) + ylab("YPLL per 100,000") + theme(panel.grid = element_blank()) + xlab("Age Group") + theme(axis.text.y = element_text(size = 10), axis.title = element_text(size = 10)) + theme(strip.text = element_text(hjust = 0.5, size = 9)) + scale_y_continuous(breaks = scales::pretty_breaks(n = 4)) + scale_x_continuous(limits=c(min(agevector$r),max(agevector$r)), breaks=agevector$r, labels=agevector$age_cat) + facet_wrap(~name, scales="free", nrow = 4) + theme(axis.text.x = element_text(size = 8, angle = 45, hjust = 1))
eypll_age_fig
fig5 <- resultsdir %>% file.path(., "icd", "eaamr_age_fig.rds") %>% readRDS() + theme(panel.grid = element_blank()) + ylab("AAMR per 100,000") + theme(axis.title = element_text(size = 14), axis.text = element_text(size = 10))
fig5
ggsave(plot = fig5, filename = file.path(msdir, "male-female-sfig3.pdf"), width = 14, height = 14, units = "in", device = cairo_pdf)
sfig3 <- resultsdir %>% file.path(., "icd", "aamr_age_fig.rds") %>% readRDS() + theme(panel.grid = element_blank()) + ylab("AAMR per 100,000") + theme(axis.title = element_text(size = 14), axis.text = element_text(size = 10))
ggsave(plot = sfig3, filename = file.path(msdir, "male-female-sfig3.pdf"), width = 13, height = 10, units = "in", device = cairo_pdf)
ggsave(plot = fig5, filename = file.path(msdir, "male-female-fig5.pdf"), width = 14, height = 14, units = "in", device = cairo_pdf)
ggsave(plot = fig5, filename = file.path(msdir, "male-female-fig5.pdf"), width = 17, height = 14, units = "in", device = cairo_pdf)
fig5 <- resultsdir %>% file.path(., "icd", "eaamr_age_fig.rds") %>% readRDS() + theme(panel.grid = element_blank()) + ylab("AAMR per 100,000") + theme(axis.title = element_text(size = 14), axis.text = element_text(size = 10)) + theme(strip.text = element_text(size = 14))
ggsave(plot = fig5, filename = file.path(msdir, "male-female-fig5.pdf"), width = 17, height = 14, units = "in", device = cairo_pdf)
fig5 <- resultsdir %>% file.path(., "icd", "eaamr_age_fig.rds") %>% readRDS() + theme(panel.grid = element_blank()) + ylab("Excess AAMR per 100,000") + theme(axis.title = element_text(size = 14), axis.text = element_text(size = 10)) + theme(strip.text = element_text(size = 14))
ggsave(plot = fig5, filename = file.path(msdir, "male-female-fig5.pdf"), width = 17, height = 14, units = "in", device = cairo_pdf)
#fig6 excess ypll by age by cause
fig6 <- resultsdir %>% file.path(., "icd", "eypll_age_fig.rds") %>% readRDS() + theme(panel.grid = element_blank()) + ylab("Excess YPLL") + theme(axis.title = element_text(size = 14), axis.text = element_text(size = 10)) + theme(strip.text = element_text(size = 14))
ggsave(plot = fig6, filename = file.path(msdir, "male-female-fig6.pdf"), width = 17, height = 14, units = "in", device = cairo_pdf)
resultsdir %>% file.path(., "icd", "aadr_age_year.rds") %>% readRDS()  + theme(panel.grid = element_blank()) + ylab("Excess Deaths per 100,000") + theme(axis.title = element_text(size = 14), axis.text = element_text(size = 10)) + xlab("Age Group")  + theme(plot.title = element_blank()),
resultsdir %>% file.path(., "icd", "aadr_age_year.rds")
resultsdir %>% file.path(., "icd", "aadr_age_year.rds") %>% readRDS()
resultsdir %>% file.path(., "icd", "aadr_age_year_fig.rds") %>% readRDS()  + theme(panel.grid = element_blank()) + ylab("Excess Deaths per 100,000") + theme(axis.title = element_text(size = 14), axis.text = element_text(size = 10)) + xlab("Age Group")  + theme(plot.title = element_blank()),
resultsdir %>% file.path(., "icd", "aadr_age_year_fig.rds") %>% readRDS() + theme(panel.grid = element_blank()) + ylab("Excess Deaths per 100,000") + theme(axis.title = element_text(size = 14), axis.text = element_text(size = 10)) + xlab("Age Group")  + theme(plot.title = element_blank())
sfig4 <- resultsdir %>% file.path(., "icd", "aadr_age_year_fig.rds") %>% readRDS() + theme(panel.grid = element_blank()) + ylab("Excess Deaths per 100,000") + theme(axis.title = element_text(size = 14), axis.text = element_text(size = 10)) + xlab("Age Group")  + theme(plot.title = element_blank())
ggsave(plot = sfig4, filename = file.path(msdir, "male-female-sfig4.pdf"), width = 14, height = 10, units = "in", device = cairo_pdf)
ggsave(plot = sfig4, filename = file.path(msdir, "male-female-sfig4.pdf"), width = 14, height = 14, units = "in", device = cairo_pdf)
ggsave(plot = sfig4, filename = file.path(msdir, "male-female-sfig4.pdf"), width = 16, height = 14, units = "in", device = cairo_pdf)
ggsave(plot = sfig4, filename = file.path(msdir, "male-female-sfig4.pdf"), width = 14, height = 16, units = "in", device = cairo_pdf)
fig2 <- resultsdir %>% file.path("icd", "eaamrs_fig.rds") %>% readRDS() + theme(axis.title = element_text(size = 14))
fig2
resultsdir %>% file.path("icd", "eaamrs_fig.rds") %>% readRDS() + theme(axis.title = element_text(size = 14))
resultsdir %>% file.path("icd", "eaamrs_fig.rds")
resultsdir %>% file.path("icd", "eaamrs_fig.rds") %>% readRDS()
eaamrs <- lapply(eaadrfiles, function(x) x %>% extract_information(.)) %>% do.call(rbind, .)
(eaamrs %>% select(-mrr) %>% left_join(icdmap, by=c("icdcode"="code")) %>% mutate(name = str_wrap(name, width = 25)))
years <- seq(first_year, 2022, 1)
year_label <- scale_x_continuous(breaks=years, labels= function(x) ifelse(x %% 2 == 0, x, ""))
figdir <- file.path("../figs", project)
resultsdir <- file.path("../results", project)
create_output_dir(resultsdir)
create_output_dir(figdir)
sizing_theme <- theme(axis.text = element_text(size=12), axis.title=element_text(size=16), legend.text=element_text(size=12), legend.title=element_text(size=16), plot.title=element_text(size=18, hjust=0.5))
panel_theme <- theme_bw() + theme(panel.grid.major.x = element_blank(), panel.grid.minor=element_blank())
icdmap <- "../raw-data/icd/icd-chapter-map.csv" %>% read_csv() %>% magrittr:::set_colnames(c("code", "name"))
#icds to drop
#U00-U99, R00-R99 are special codes (COVID19, clinical/lab findings not explained elsewhere)
filter_out_codes <- c("U00-U99", "R00-R99") %>% paste0(., collapse = "|")
#collect all the folders
dirs <- list.dirs(path = "../outputs", recursive = FALSE)
icddirs <- dirs[grepl("icd-.*-", dirs)]
icddirs <- icddirs[!grepl("hisp|race", icddirs)]
icddirs <- icddirs[!icddirs %>% grepl(filter_out_codes, .)]
tabledir <- file.path(icddirs, "tables")
aadrfiles <- file.path(tabledir, "aadr_sex_year.csv")
eaadrfiles <- file.path(tabledir, "excess_aadr_year.csv")
eaadrfiles
eaamrs <- lapply(eaadrfiles, function(x) x %>% extract_information(.)) %>% do.call(rbind, .)
eaamrs
eaadrfiles
eaadrfiles[3] %>% read_csv()
"icd-C00-D48"
input_name <- "icd-C00-D48"
first_year <- 2000
outdir <- "../processed-data-files"
df <- paste0("../raw-data/", input_name, "/", input_name, "-deaths.csv") %>% read_csv()
pop <- paste0("../raw-data/", input_name, "/master-population.csv") %>% read_csv()
pop <- pop %>% filter(Population != "Not Applicable") %>% type.convert(as.is = TRUE)
pop <- pop %>% filter(`Five-Year Age Groups` != "Not Stated")
if (!dir.exists(outdir)){
dir.create(outdir)
}
workdir <- file.path(outdir, input_name)
if (!dir.exists(workdir)){
dir.create(workdir)
}
start_years <- c(2020, 2013, 2006, first_year)
end_years <- c(2022, 2019, 2012, 2005)
start_year <- first_year
end_year <- 2022
##
age_first <- 0
age_first_i <- 0
include_lowest <- TRUE
age_breaks <- c(0, 1, 4, 9, 14, 19, 24, 29, 34, 39, 44, 49, 54, 59, 64, 69, 74, 79, 84, Inf)
age_labels <- c("< 1", "1-4", "5-9", "10-14", "15-19", "20-24", "25-29", "30-34", "35-39", "40-44", "45-49", "50-54", "55-59", "60-64", "65-69", "70-74", "75-79", "80-84", "85+")
start_index <- which(age_breaks == age_first_i)
trimmed_age_breaks <- age_breaks[start_index:length(age_breaks)]
trimmed_age_labels <- age_labels[start_index:length(age_labels)]
df <- df %>% filter(!`Five-Year Age Groups` %in% c("85-59 years", "90-94 years", "95-99 years", "100+ years"))
#2000 standard
aa_df <- read.table("../raw-data/age_2000_standard_population_final.tsv", header = TRUE, sep = "\t") %>% as_tibble()
aa_df
df
aa_df$age_groups <- cut(aa_df$Age,
breaks = trimmed_age_breaks,
labels = trimmed_age_labels,
include.lowest = include_lowest)
aa_df <- aa_df[complete.cases(aa_df$age_groups), ]
aa_df$Age_groups <- as.character(aa_df$age_groups)
aa_df$Age_groups <- ifelse(aa_df$Age == "1", "1-4", aa_df$Age_groups)
aa_df <- aggregate(Population ~ Age_groups, aa_df, sum)
aa_df <- aa_df %>% filter(Age_groups != "85+")
aa_df
for (i in 1:nrow(aa_df)) {aa_df$AA_proportion[i] <- aa_df$Population[i] / sum(aa_df$Population) }
aa_df
for (i in seq_along(start_years)) {
start_year_i <- start_years[i]
end_year_i <- end_years[i]
filtered_data <- df[df$Year >= start_year_i & df$Year <= end_year_i, ]
filtered_data <- filtered_data %>% group_by(`Five-Year Age Groups`, Gender) %>% summarize(Deaths = sum(Deaths)) %>% ungroup()
pop_df <- pop[pop$Year >= start_year_i & pop$Year <= end_year_i,]
pop_df <- pop_df %>% group_by(`Five-Year Age Groups`, Gender) %>% summarize(Population = sum(Population)) %>% ungroup()
dat <- filtered_data %>% left_join(pop_df, by=c("Gender"="Gender", "Five-Year Age Groups"="Five-Year Age Groups")) %>% mutate(`Crude Rate` = (Deaths/Population)*100000)
dat <- dat %>% mutate(Gender = ifelse(Gender == "Female", "F", "M"))
dat <- dat %>% filter(`Five-Year Age Groups` %in% paste0(trimmed_age_labels, c(" year", rep(" years", length(trimmed_age_labels) - 1))))
file_name <- paste0(workdir, "/deaths_crude_gender_age_", start_year_i, "-", end_year_i, ".tsv")
write.table(dat, file = file_name, sep = "\t", quote = FALSE, row.names = FALSE)
}
#start here
for (i in seq_along(start_years)) {
start_year_i <- start_years[i]
end_year_i <- end_years[i]
filtered_data <- df[df$Year >= start_year_i & df$Year <= end_year_i, ]
filtered_data <- filtered_data %>% group_by(`Five-Year Age Groups`, Gender, Year) %>% summarize(Deaths = sum(Deaths)) %>% ungroup()
pop_df <- pop[pop$Year >= start_year_i & pop$Year <= end_year_i,]
pop_df <- pop_df %>% group_by(`Five-Year Age Groups`, Gender, Year) %>% summarize(Population = sum(Population)) %>% ungroup()
dat <- filtered_data %>% left_join(pop_df, by=c("Gender"="Gender", "Five-Year Age Groups"="Five-Year Age Groups", "Year"="Year")) %>% mutate(`Crude Rate` = (Deaths/Population)*100000)
dat <- dat %>% mutate(Gender = ifelse(Gender == "Female", "F", "M"))
dat <- dat %>% filter(`Five-Year Age Groups` %in% paste0(trimmed_age_labels, c(" year", rep(" years", length(trimmed_age_labels) - 1))))
file_name <- paste0(workdir, "/deaths_crude_gender_age_year_", start_year_i, "-", end_year_i, ".tsv")
write.table(dat, file = file_name, sep = "\t", quote = FALSE, row.names = FALSE)
}
filtered_data <- df[df$Year >= start_year & df$Year <= end_year, ]
filtered_data <- filtered_data %>% group_by(`Five-Year Age Groups`, Gender, Year) %>% summarize(Deaths = sum(Deaths)) %>% ungroup()
pop_df <- pop[pop$Year >= start_year & pop$Year <= end_year,]
pop_df <- pop_df %>% group_by(`Five-Year Age Groups`, Gender, Year) %>% summarize(Population = sum(Population)) %>% ungroup()
dat <- filtered_data %>% left_join(pop_df, by=c("Gender"="Gender", "Five-Year Age Groups"="Five-Year Age Groups", "Year"="Year")) %>% mutate(`Crude Rate` = (Deaths/Population)*100000)
dat <- dat %>% mutate(Gender = ifelse(Gender == "Female", "F", "M"))
dat <- dat %>% filter(`Five-Year Age Groups` %in% paste0(trimmed_age_labels, c(" year", rep(" years", length(trimmed_age_labels) - 1))))
file_name <- paste0(workdir, "/export_deaths_crude_gender_age_year.tsv")
write.table(dat, file = file_name, sep = "\t", quote = FALSE, row.names = FALSE)
#
filtered_data <- df[df$Year >= start_year & df$Year <= end_year, ]
filtered_data <- filtered_data %>% filter(`Five-Year Age Groups` %in% paste0(trimmed_age_labels, c(" year", rep(" years", length(trimmed_age_labels) - 1))))
filtered_data <- filtered_data[complete.cases(filtered_data$`Five-Year Age Groups`), ]
filtered_data$Age_groups <- as.character(filtered_data$`Five-Year Age Groups`)
filtered_data$Age_groups <- ifelse(filtered_data$`Five-Year Age Groups` == "1", "1-4", filtered_data$Age_groups)
filtered_data <- filtered_data %>% group_by(Age_groups, Gender, Year) %>% summarize(Deaths = sum(Deaths)) %>% ungroup()
pop_df <- pop[pop$Year >= start_year & pop$Year <= end_year,]
pop_df <- pop_df %>% filter(`Five-Year Age Groups` %in% paste0(trimmed_age_labels, c(" year", rep(" years", length(trimmed_age_labels) - 1))))
pop_df <- pop_df[complete.cases(pop_df$`Five-Year Age Groups`), ]
pop_df$Age_groups <- as.character(pop_df$`Five-Year Age Groups`)
pop_df$Age_groups <- ifelse(pop_df$`Five-Year Age Groups` == "1", "1-4", pop_df$Age_groups)
pop_df <- pop_df %>% group_by(Age_groups, Gender, Year) %>% summarize(Population = sum(Population)) %>% ungroup()
dat <- filtered_data %>% left_join(pop_df, by=c("Gender"="Gender", "Age_groups"="Age_groups", "Year"="Year")) %>% mutate(`Crude Rate` = (Deaths/Population)*100000)
dat <- dat %>% mutate(Gender = ifelse(Gender == "Female", "F", "M"))
file_name <- paste0(workdir, "/export_deaths_gender_age_year.tsv")
write.table(dat, file = file_name, sep = "\t", quote = FALSE, row.names = FALSE)
#
filtered_data <- df[df$Year >= start_year & df$Year <= end_year, ]
filtered_data <- filtered_data %>% filter(`Five-Year Age Groups` %in% paste0(trimmed_age_labels, c(" year", rep(" years", length(trimmed_age_labels) - 1))))
filtered_data <- filtered_data[complete.cases(filtered_data$`Five-Year Age Groups`), ]
filtered_data <- filtered_data %>% group_by(`Five-Year Age Groups`, Gender, Year) %>% summarize(Deaths = sum(Deaths)) %>% ungroup()
pop_df <- pop[pop$Year >= start_year & pop$Year <= end_year,]
pop_df <- pop_df %>% filter(`Five-Year Age Groups` %in% paste0(trimmed_age_labels, c(" year", rep(" years", length(trimmed_age_labels) - 1))))
pop_df <- pop_df[complete.cases(pop_df$`Five-Year Age Groups`), ]
pop_df <- pop_df %>% group_by(`Five-Year Age Groups`, Gender, Year) %>% summarize(Population = sum(Population)) %>% ungroup()
dat <- filtered_data %>% left_join(pop_df, by=c("Gender"="Gender", "Five-Year Age Groups" = "Five-Year Age Groups", "Year"="Year")) %>% mutate(`Crude Rate` = (Deaths/Population)*100000)
dat
aa_df
aa_df <- aa_df %>% mutate(`Five-Year Age Groups`= paste0(Age_groups, " years"))
aa_df
dat
dat$`Five-Year Age Groups` %>% unique()
aa_df <- aa_df %>% mutate(`Five-Year Age Groups`= paste0(Age_groups, " years")) %>% mutate(`Five-Year Age Groups` = ifelse(`Five-Year Age Groups` == "< 1 years", "< 1 year", `Five-Year Age Groups`))
dat <- dat %>% left_join(aa_df %>% select(3,4) , by = c("Five-Year Age Groups"="Five-Year Age Groups")) %>% mutate(AA_rate = `Crude Rate`*AA_proportion)
dat
dat <- dat %>% group_by(Gender, Year) %>% summarize(AA_rate = sum(AA_rate), Deaths = sum(Deaths), Population = sum(Population)) %>% mutate(`Crude Rate`= (Deaths / Population) * 100000) %>% mutate(Gender = ifelse(Gender == "Female", "F", "M")) %>% ungroup()
dat
eaamrs <- lapply(eaadrfiles, function(x) x %>% extract_information(.)) %>% do.call(rbind, .)
eaamrs
eaadrfiles
eaadrfiles[3] %>% read_csv()
filtered_data <- df[df$Year >= start_year & df$Year <= end_year, ]
filtered_data <- filtered_data %>% filter(`Five-Year Age Groups` %in% paste0(trimmed_age_labels, c(" year", rep(" years", length(trimmed_age_labels) - 1))))
filtered_data <- filtered_data[complete.cases(filtered_data$`Five-Year Age Groups`), ]
filtered_data <- filtered_data %>% group_by(`Five-Year Age Groups`, Gender, Year) %>% summarize(Deaths = sum(Deaths)) %>% ungroup()
pop_df <- pop[pop$Year >= start_year & pop$Year <= end_year,]
pop_df <- pop_df %>% filter(`Five-Year Age Groups` %in% paste0(trimmed_age_labels, c(" year", rep(" years", length(trimmed_age_labels) - 1))))
pop_df <- pop_df[complete.cases(pop_df$`Five-Year Age Groups`), ]
pop_df <- pop_df %>% group_by(`Five-Year Age Groups`, Gender, Year) %>% summarize(Population = sum(Population)) %>% ungroup()
dat <- filtered_data %>% left_join(pop_df, by=c("Gender"="Gender", "Five-Year Age Groups" = "Five-Year Age Groups", "Year"="Year")) %>% mutate(`Crude Rate` = (Deaths/Population)*100000)
aa_df <- aa_df %>% mutate(`Five-Year Age Groups`= paste0(Age_groups, " years")) %>% mutate(`Five-Year Age Groups` = ifelse(`Five-Year Age Groups` == "< 1 years", "< 1 year", `Five-Year Age Groups`))
dat <- dat %>% left_join(aa_df %>% select(3,4) , by = c("Five-Year Age Groups"="Five-Year Age Groups")) %>% mutate(AA_rate = `Crude Rate`*AA_proportion)
dat <- dat %>% group_by(Gender, Year) %>% summarize(AA_rate = sum(AA_rate), Deaths = sum(Deaths), Population = sum(Population)) %>% mutate(`Crude Rate`= (Deaths / Population) * 100000) %>% mutate(Gender = ifelse(Gender == "Female", "F", "M")) %>% ungroup()
dat
project
project <- "icd-C00-D48"
first_year
years <- seq(first_year, 2022, 1)
datadir <- "../processed-data-files"
inputfile <- file.path(file.path(datadir, project), "export_age_adjusted_deaths_gender_year_se.tsv")
inputfile2 <- file.path(file.path(datadir, project), "export_deaths_gender_age_year.tsv")
#output directory and file
outputdir <- file.path("../results", project, "excess-mortality-by-year")
#table directory
#plot output dir
plotdir <- file.path("../outputs", project, "excess-mortality-by-year")
#palette of colors
cbb <- c("#E69F00", "#56B4E9", "#009E73", "#0072B2", "#D55E00", "#CC79A7")
tabledir <- file.path(dirname(plotdir), "tables")
create_output_dir(tabledir)
######## CODE ######
data <- preprocess_cdc_wonder(inputfile)
data
input_name
outdir <- "../processed-data-files"
df <- paste0("../raw-data/", input_name, "/", input_name, "-deaths.csv") %>% read_csv()
pop <- paste0("../raw-data/", input_name, "/master-population.csv") %>% read_csv()
pop <- pop %>% filter(Population != "Not Applicable") %>% type.convert(as.is = TRUE)
pop <- pop %>% filter(`Five-Year Age Groups` != "Not Stated")
if (!dir.exists(outdir)){
dir.create(outdir)
}
workdir <- file.path(outdir, input_name)
if (!dir.exists(workdir)){
dir.create(workdir)
}
start_years <- c(2020, 2013, 2006, first_year)
end_years <- c(2022, 2019, 2012, 2005)
start_year <- first_year
end_year <- 2022
##
age_first <- 0
age_first_i <- 0
include_lowest <- TRUE
age_breaks <- c(0, 1, 4, 9, 14, 19, 24, 29, 34, 39, 44, 49, 54, 59, 64, 69, 74, 79, 84, Inf)
age_labels <- c("< 1", "1-4", "5-9", "10-14", "15-19", "20-24", "25-29", "30-34", "35-39", "40-44", "45-49", "50-54", "55-59", "60-64", "65-69", "70-74", "75-79", "80-84", "85+")
start_index <- which(age_breaks == age_first_i)
trimmed_age_breaks <- age_breaks[start_index:length(age_breaks)]
trimmed_age_labels <- age_labels[start_index:length(age_labels)]
df <- df %>% filter(!`Five-Year Age Groups` %in% c("85-59 years", "90-94 years", "95-99 years", "100+ years"))
#2000 standard
aa_df <- read.table("../raw-data/age_2000_standard_population_final.tsv", header = TRUE, sep = "\t") %>% as_tibble()
aa_df$age_groups <- cut(aa_df$Age,
breaks = trimmed_age_breaks,
labels = trimmed_age_labels,
include.lowest = include_lowest)
aa_df <- aa_df[complete.cases(aa_df$age_groups), ]
aa_df$Age_groups <- as.character(aa_df$age_groups)
aa_df$Age_groups <- ifelse(aa_df$Age == "1", "1-4", aa_df$Age_groups)
aa_df <- aggregate(Population ~ Age_groups, aa_df, sum)
aa_df <- aa_df %>% filter(Age_groups != "85+")
for (i in 1:nrow(aa_df)) {aa_df$AA_proportion[i] <- aa_df$Population[i] / sum(aa_df$Population) }
for (i in seq_along(start_years)) {
start_year_i <- start_years[i]
end_year_i <- end_years[i]
filtered_data <- df[df$Year >= start_year_i & df$Year <= end_year_i, ]
filtered_data <- filtered_data %>% group_by(`Five-Year Age Groups`, Gender) %>% summarize(Deaths = sum(Deaths)) %>% ungroup()
pop_df <- pop[pop$Year >= start_year_i & pop$Year <= end_year_i,]
pop_df <- pop_df %>% group_by(`Five-Year Age Groups`, Gender) %>% summarize(Population = sum(Population)) %>% ungroup()
dat <- filtered_data %>% left_join(pop_df, by=c("Gender"="Gender", "Five-Year Age Groups"="Five-Year Age Groups")) %>% mutate(`Crude Rate` = (Deaths/Population)*100000)
dat <- dat %>% mutate(Gender = ifelse(Gender == "Female", "F", "M"))
dat <- dat %>% filter(`Five-Year Age Groups` %in% paste0(trimmed_age_labels, c(" year", rep(" years", length(trimmed_age_labels) - 1))))
file_name <- paste0(workdir, "/deaths_crude_gender_age_", start_year_i, "-", end_year_i, ".tsv")
write.table(dat, file = file_name, sep = "\t", quote = FALSE, row.names = FALSE)
}
#start here
for (i in seq_along(start_years)) {
start_year_i <- start_years[i]
end_year_i <- end_years[i]
filtered_data <- df[df$Year >= start_year_i & df$Year <= end_year_i, ]
filtered_data <- filtered_data %>% group_by(`Five-Year Age Groups`, Gender, Year) %>% summarize(Deaths = sum(Deaths)) %>% ungroup()
pop_df <- pop[pop$Year >= start_year_i & pop$Year <= end_year_i,]
pop_df <- pop_df %>% group_by(`Five-Year Age Groups`, Gender, Year) %>% summarize(Population = sum(Population)) %>% ungroup()
dat <- filtered_data %>% left_join(pop_df, by=c("Gender"="Gender", "Five-Year Age Groups"="Five-Year Age Groups", "Year"="Year")) %>% mutate(`Crude Rate` = (Deaths/Population)*100000)
dat <- dat %>% mutate(Gender = ifelse(Gender == "Female", "F", "M"))
dat <- dat %>% filter(`Five-Year Age Groups` %in% paste0(trimmed_age_labels, c(" year", rep(" years", length(trimmed_age_labels) - 1))))
file_name <- paste0(workdir, "/deaths_crude_gender_age_year_", start_year_i, "-", end_year_i, ".tsv")
write.table(dat, file = file_name, sep = "\t", quote = FALSE, row.names = FALSE)
}
filtered_data <- df[df$Year >= start_year & df$Year <= end_year, ]
filtered_data <- filtered_data %>% group_by(`Five-Year Age Groups`, Gender, Year) %>% summarize(Deaths = sum(Deaths)) %>% ungroup()
pop_df <- pop[pop$Year >= start_year & pop$Year <= end_year,]
pop_df <- pop_df %>% group_by(`Five-Year Age Groups`, Gender, Year) %>% summarize(Population = sum(Population)) %>% ungroup()
dat <- filtered_data %>% left_join(pop_df, by=c("Gender"="Gender", "Five-Year Age Groups"="Five-Year Age Groups", "Year"="Year")) %>% mutate(`Crude Rate` = (Deaths/Population)*100000)
dat <- dat %>% mutate(Gender = ifelse(Gender == "Female", "F", "M"))
dat <- dat %>% filter(`Five-Year Age Groups` %in% paste0(trimmed_age_labels, c(" year", rep(" years", length(trimmed_age_labels) - 1))))
file_name <- paste0(workdir, "/export_deaths_crude_gender_age_year.tsv")
write.table(dat, file = file_name, sep = "\t", quote = FALSE, row.names = FALSE)
#
filtered_data <- df[df$Year >= start_year & df$Year <= end_year, ]
filtered_data <- filtered_data %>% filter(`Five-Year Age Groups` %in% paste0(trimmed_age_labels, c(" year", rep(" years", length(trimmed_age_labels) - 1))))
filtered_data <- filtered_data[complete.cases(filtered_data$`Five-Year Age Groups`), ]
filtered_data$Age_groups <- as.character(filtered_data$`Five-Year Age Groups`)
filtered_data$Age_groups <- ifelse(filtered_data$`Five-Year Age Groups` == "1", "1-4", filtered_data$Age_groups)
filtered_data <- filtered_data %>% group_by(Age_groups, Gender, Year) %>% summarize(Deaths = sum(Deaths)) %>% ungroup()
pop_df <- pop[pop$Year >= start_year & pop$Year <= end_year,]
pop_df <- pop_df %>% filter(`Five-Year Age Groups` %in% paste0(trimmed_age_labels, c(" year", rep(" years", length(trimmed_age_labels) - 1))))
pop_df <- pop_df[complete.cases(pop_df$`Five-Year Age Groups`), ]
pop_df$Age_groups <- as.character(pop_df$`Five-Year Age Groups`)
pop_df$Age_groups <- ifelse(pop_df$`Five-Year Age Groups` == "1", "1-4", pop_df$Age_groups)
pop_df <- pop_df %>% group_by(Age_groups, Gender, Year) %>% summarize(Population = sum(Population)) %>% ungroup()
dat <- filtered_data %>% left_join(pop_df, by=c("Gender"="Gender", "Age_groups"="Age_groups", "Year"="Year")) %>% mutate(`Crude Rate` = (Deaths/Population)*100000)
dat <- dat %>% mutate(Gender = ifelse(Gender == "Female", "F", "M"))
file_name <- paste0(workdir, "/export_deaths_gender_age_year.tsv")
write.table(dat, file = file_name, sep = "\t", quote = FALSE, row.names = FALSE)
#
filtered_data <- df[df$Year >= start_year & df$Year <= end_year, ]
filtered_data <- filtered_data %>% filter(`Five-Year Age Groups` %in% paste0(trimmed_age_labels, c(" year", rep(" years", length(trimmed_age_labels) - 1))))
filtered_data <- filtered_data[complete.cases(filtered_data$`Five-Year Age Groups`), ]
filtered_data <- filtered_data %>% group_by(`Five-Year Age Groups`, Gender, Year) %>% summarize(Deaths = sum(Deaths)) %>% ungroup()
pop_df <- pop[pop$Year >= start_year & pop$Year <= end_year,]
pop_df <- pop_df %>% filter(`Five-Year Age Groups` %in% paste0(trimmed_age_labels, c(" year", rep(" years", length(trimmed_age_labels) - 1))))
pop_df <- pop_df[complete.cases(pop_df$`Five-Year Age Groups`), ]
pop_df <- pop_df %>% group_by(`Five-Year Age Groups`, Gender, Year) %>% summarize(Population = sum(Population)) %>% ungroup()
dat <- filtered_data %>% left_join(pop_df, by=c("Gender"="Gender", "Five-Year Age Groups" = "Five-Year Age Groups", "Year"="Year")) %>% mutate(`Crude Rate` = (Deaths/Population)*100000)
aa_df <- aa_df %>% mutate(`Five-Year Age Groups`= paste0(Age_groups, " years")) %>% mutate(`Five-Year Age Groups` = ifelse(`Five-Year Age Groups` == "< 1 years", "< 1 year", `Five-Year Age Groups`))
dat <- dat %>% left_join(aa_df %>% select(3,4) , by = c("Five-Year Age Groups"="Five-Year Age Groups")) %>% mutate(AA_rate = `Crude Rate`*AA_proportion)
dat <- dat %>% group_by(Gender, Year) %>% summarize(AA_rate = sum(AA_rate), Deaths = sum(Deaths), Population = sum(Population)) %>% mutate(`Crude Rate`= (Deaths / Population) * 100000) %>% mutate(Gender = ifelse(Gender == "Female", "F", "M")) %>% ungroup()
dat
file_name <- paste0(workdir, "/export_age_adjusted_deaths_gender_year_se.tsv")
write.table(dat, file = file_name, sep = "\t", quote = FALSE, row.names = FALSE)
years <- seq(first_year, 2022, 1)
datadir <- "../processed-data-files"
inputfile <- file.path(file.path(datadir, project), "export_age_adjusted_deaths_gender_year_se.tsv")
inputfile2 <- file.path(file.path(datadir, project), "export_deaths_gender_age_year.tsv")
#output directory and file
outputdir <- file.path("../results", project, "excess-mortality-by-year")
#table directory
#plot output dir
plotdir <- file.path("../outputs", project, "excess-mortality-by-year")
#palette of colors
cbb <- c("#E69F00", "#56B4E9", "#009E73", "#0072B2", "#D55E00", "#CC79A7")
tabledir <- file.path(dirname(plotdir), "tables")
create_output_dir(tabledir)
######## CODE ######
data <- preprocess_cdc_wonder(inputfile)
data
sfig2 <- resultsdir %>% file.path("icd", "sex_aamrs_fig.rds") %>% readRDS() + theme(axis.title = element_text(size = 14))
resultsidr
resultsdir
resultsdir %>% file.path("sex_aamrs_fig.rds") %>% readRDS()
sfig4 <- resultsdir %>% file.path(., "icd", "aadr_age_year_fig.rds") %>% readRDS() + theme(panel.grid = element_blank()) + ylab("Excess AAMR per 100,000") + theme(axis.title = element_text(size = 14), axis.text = element_text(size = 10)) + xlab("Age Group")  + theme(plot.title = element_blank())
resultsdir <- file.path("../results")
msdir <- file.path("../ms-figs")
if (!dir.exists(msdir)){
dir.create(msdir)
}
years <- seq(first_year, 2022, 1)
year_label <- scale_x_continuous(breaks=years, labels= function(x) ifelse(x %% 2 == 0, x, ""))
colorpal <- ggsci::pal_jama("default")(7)
colorcorrect <- function(bpal = colorpal[c(4,6)]){
scale_color_manual(values = bpal[1:2])
}
#F1 - a) population pct, b) excess aamr by year, c) excess ypll by year
fig1 <- cowplot::plot_grid(resultsdir %>% file.path("icd", "pop_pct_fig.rds") %>% readRDS(), cowplot::plot_grid(resultsdir %>% file.path("all-deaths", "excess-mortality-by-year", "excess_death_rate_fig.rds") %>% readRDS() + year_label + geom_line(color = "grey70", size = 1.25) + theme(panel.grid = element_blank()) + ylab("Excess AAAMR per 100,000") + theme(axis.text.x = element_text(angle = 45, hjust = 1))+ theme(plot.title = element_blank()) + scale_y_continuous(breaks = scales::pretty_breaks(n = 10), limits = c(200, 300)), resultsdir %>% file.path("all-deaths", "life-years-lost-by-year", "excess_pll_fig_label_correct.rds") %>% readRDS() + ylab("Excess YPLL (Hundred Thousands)") + theme(axis.text.x = element_text(angle = 45)) + theme(axis.text.x = element_text(angle = 45, hjust = 1)) + scale_y_continuous(breaks = scales::pretty_breaks(n = 10), limits = c(60, 110)) + year_label + geom_line(color = "grey70", size = 1.25) + theme(plot.title = element_blank()) + theme(panel.grid = element_blank()), nrow = 2, ncol = 1, labels = c("B", "C"), label_size = 18), nrow = 1, rel_widths = c(1.2, 1), labels = c("A", ""), label_size = 18 )
ggsave(plot = fig1, filename = file.path(msdir, "male-female-fig1.pdf"), width = 17, height = 10, units = "in", device = cairo_pdf)
#SF1 population heatmap
sfig1 <- resultsdir %>% file.path("icd", "pop_pct_heatmap_fig.rds") %>% readRDS() + year_label + theme(axis.ticks = element_line(color = "black"), axis.text.y = element_text(hjust = 1)) + scale_x_continuous(expand = c(0, 0), breaks=years, labels= function(x) ifelse(x %% 2 == 0, x, ""))  + theme(axis.text.y = element_text(size = 10))
ggsave(plot = sfig1, filename = file.path(msdir, "male-female-sfig1.pdf"), width = 13, height = 9, units = "in", device = cairo_pdf)
#F2 - excess aamr by cause by year
fig2 <- resultsdir %>% file.path("icd", "eaamrs_fig.rds") %>% readRDS() + theme(axis.title = element_text(size = 14))
ggsave(plot = fig2, filename = file.path(msdir, "male-female-fig2.pdf"), width = 13, height = 10, units = "in", device = cairo_pdf)
#SF2 AAMR by cause by year
sfig2 <- resultsdir %>% file.path("icd", "sex_aamrs_fig.rds") %>% readRDS() + theme(axis.title = element_text(size = 14))
ggsave(plot = sfig2, filename = file.path(msdir, "male-female-sfig2.pdf"), width = 13, height = 10, units = "in", device = cairo_pdf)
#F3 excess ypll by cause by year
fig3 <- resultsdir %>% file.path("icd", "ypll_fig.rds") %>% readRDS() + theme(axis.title = element_text(size = 14))
ggsave(plot = fig3, filename = file.path(msdir, "male-female-fig3.pdf"), width = 13, height = 10, units = "in", device = cairo_pdf)
#F4 - by age all-deaths
fig4 <- cowplot::plot_grid(resultsdir %>% file.path("all-deaths", "excess-mortality-by-age", "excess_death_rate_age_fig.rds") %>% readRDS() + theme(panel.grid = element_blank()) + ylab("Excess AAMR per 100,000") + theme(axis.title = element_text(size = 14), axis.text = element_text(size = 10)) + xlab("Age Group") + geom_point(size = 3, color = "grey70") + geom_line(color = "grey70") + theme(plot.title = element_blank()),
resultsdir %>% file.path("all-deaths", "excess-mortality-by-age", "excess_death_rate_age_year_fig.rds") %>% readRDS()  + theme(panel.grid = element_blank()) + ylab("Excess AAMR per 100,000") + theme(axis.title = element_text(size = 14), axis.text = element_text(size = 10)) + xlab("Age Group")  + theme(plot.title = element_blank()),
resultsdir %>% file.path("all-deaths", "life-years-lost-by-age", "excess_pll_fig.rds") %>% readRDS() + theme(panel.grid = element_blank()) + ylab("Excess YPLL per 100,000") + theme(axis.title = element_text(size = 14), axis.text = element_text(size = 10)) + xlab("Age Group") + geom_point(size = 3, color = "grey70") + geom_line(color = "grey70") + theme(plot.title = element_blank()),
resultsdir %>% file.path("all-deaths", "life-years-lost-by-age", "excess_pll_year_fig.rds") %>% readRDS() + theme(panel.grid = element_blank()) + ylab("Excess YPLL per 100,000") + theme(axis.title = element_text(size = 14), axis.text = element_text(size = 10)) + xlab("Age Group")  + theme(plot.title = element_blank()), nrow = 2, ncol = 2, rel_widths = c(1, 1.25), labels = c("A", "B", "C", "D"), label_size = 16)
ggsave(plot = fig4, filename = file.path(msdir, "male-female-fig4.pdf"), width = 13, height = 9, units = "in", device = cairo_pdf)
#SF3 aamr by age by cause
sfig3 <- resultsdir %>% file.path(., "icd", "aamr_age_fig.rds") %>% readRDS() + theme(panel.grid = element_blank()) + ylab("AAMR per 100,000") + theme(axis.title = element_text(size = 14), axis.text = element_text(size = 10))
ggsave(plot = sfig3, filename = file.path(msdir, "male-female-sfig3.pdf"), width = 13, height = 10, units = "in", device = cairo_pdf)
#fig5 excess aamr by age by cause
fig5 <- resultsdir %>% file.path(., "icd", "eaamr_age_fig.rds") %>% readRDS() + theme(panel.grid = element_blank()) + ylab("Excess AAMR per 100,000") + theme(axis.title = element_text(size = 14), axis.text = element_text(size = 10)) + theme(strip.text = element_text(size = 14))
ggsave(plot = fig5, filename = file.path(msdir, "male-female-fig5.pdf"), width = 17, height = 14, units = "in", device = cairo_pdf)
#fig6 excess ypll by age by cause
fig6 <- resultsdir %>% file.path(., "icd", "eypll_age_fig.rds") %>% readRDS() + theme(panel.grid = element_blank()) + ylab("Excess YPLL") + theme(axis.title = element_text(size = 14), axis.text = element_text(size = 10)) + theme(strip.text = element_text(size = 14))
ggsave(plot = fig6, filename = file.path(msdir, "male-female-fig6.pdf"), width = 17, height = 14, units = "in", device = cairo_pdf)
#sf4 excess aamr by age and year and cause
sfig4 <- resultsdir %>% file.path(., "icd", "aadr_age_year_fig.rds") %>% readRDS() + theme(panel.grid = element_blank()) + ylab("Excess AAMR per 100,000") + theme(axis.title = element_text(size = 14), axis.text = element_text(size = 10)) + xlab("Age Group")  + theme(plot.title = element_blank())
ggsave(plot = sfig4, filename = file.path(msdir, "male-female-sfig4.pdf"), width = 14, height = 16, units = "in", device = cairo_pdf)
#sf5 excess ypll by age and year and cause
sfig5 <- resultsdir %>% file.path(., "icd", "ypll_age_year_fig.rds") %>% readRDS() + theme(panel.grid = element_blank()) + ylab("Excess YPLL per 100,000") + theme(axis.title = element_text(size = 14), axis.text = element_text(size = 10)) + xlab("Age Group")  + theme(plot.title = element_blank())
ggsave(plot = sfig5, filename = file.path(msdir, "male-female-sfig5.pdf"), width = 14, height = 16, units = "in", device = cairo_pdf)
fig2
sfig2
resultsdir %>% file.path("icd", "ypll_fig.rds") %>% readRDS() + theme(axis.title = element_text(size = 14))
ile.path("all-deaths", "life-years-lost-by-age", "excess_pll_fig.rds") %>% readRDS()
file.path("all-deaths", "life-years-lost-by-age", "excess_pll_fig.rds") %>% readRDS()
resultsdir %>% file.path("all-deaths", "life-years-lost-by-age", "excess_pll_fig.rds") %>% readRDS()
resultsdir %>% file.path(., "icd", "eypll_age_fig.rds") %>% readRDS()
